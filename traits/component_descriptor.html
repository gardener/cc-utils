

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>component_descriptor Trait &mdash; cc-utils  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="cronjob Trait" href="cronjob.html" />
    <link rel="prev" title="Pipeline Definition Traits" href="../traits.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            cc-utils
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">Pipeline Definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_job.html">Pipeline Job</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_step.html">Pipeline Steps</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../traits.html">Pipeline Definition Traits</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#"><em>component_descriptor</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="cronjob.html"><em>cronjob</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="draft_release.html"><em>draft_release</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_scan.html"><em>image_scan</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="notifications.html"><em>notifications</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html"><em>options</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="publish.html"><em>publish</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="pullrequest.html"><em>pull-request</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html"><em>release</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="scan_sources.html"><em>scan_sources</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheduling.html"><em>scheduling</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="slack.html"><em>slack</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="update_component_deps.html"><em>update_component_deps</em> Trait</a></li>
<li class="toctree-l2"><a class="reference internal" href="version.html"><em>version</em> Trait</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes Process</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">cc-utils</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../traits.html">Pipeline Definition Traits</a></li>
      <li class="breadcrumb-item active"><em>component_descriptor</em> Trait</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/traits/component_descriptor.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="component-descriptor-trait">
<h1><em>component_descriptor</em> Trait<a class="headerlink" href="#component-descriptor-trait" title="Link to this heading"></a></h1>
<section id="trait-component-descriptor">
<span id="trait-component-descriptor"></span><h2>Attributes<a class="headerlink" href="#trait-component-descriptor" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>required?</p></th>
<th class="head"><p>default</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>step</p></td>
<td><p>no</p></td>
<td><p><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">component_descriptor</span>
</pre></div>
</div>
</p></td>
<td><p>dict</p></td>
<td><p>The build step name injected by this trait</p></td>
</tr>
<tr class="row-odd"><td><p>resolve_dependencies</p></td>
<td><p>no</p></td>
<td><p>True</p></td>
<td><p>bool</p></td>
<td><p>Indicates whether or not unresolved component dependencies should be resolved</p></td>
</tr>
<tr class="row-even"><td><p>upload</p></td>
<td><p>no</p></td>
<td><p>legacy</p></td>
<td><p>UploadMode</p></td>
<td><p>Indicates whether or not to publish component-descriptor during Component-Descriptor
step. For backwards-compatibility reasons, defaults to “legacy”, which is a mode
that depends on pipeline’s context.
Should be configured to <code class="code docutils literal notranslate"><span class="pre">no-upload</span></code> (which is the intended default behaviour)</p></td>
</tr>
<tr class="row-odd"><td><p>component_name</p></td>
<td><p>no</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p>Manually overwrites the component name (which defaults to github repository path)</p></td>
</tr>
<tr class="row-even"><td><p>callback_env</p></td>
<td><p>no</p></td>
<td><p><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{}</span>
</pre></div>
</div>
</p></td>
<td><p>str</p></td>
<td><p>Specifies additional environment variables passed to .ci/component_descriptor script</p></td>
</tr>
<tr class="row-odd"><td><p>retention_policy</p></td>
<td><p>no</p></td>
<td><p>None</p></td>
<td><p><p>One of:</p>
<ul class="simple">
<li><p>VersionRetentionPolicies</p></li>
<li><p>str</p></li>
</ul>
</p></td>
<td><p><p>specifies how (old) component-descriptors and their referenced resources should be
handled. This is foremostly intended as an option for automated cleanup for
components with frequent (shortlived) releases and/or frequent (shortlived) snapshots.</p>
<p>if no retention_policy is defined, no cleanup will be done.</p>
<p>retention policy may either be defined “inline” (as a mapping value) or by referencing
a pre-defined policy by name (see <code class="code docutils literal notranslate"><span class="pre">retentions_policies</span></code> attribute). In the latter case,
use the policie’s name as (string) attribute value.</p>
</p></td>
</tr>
<tr class="row-even"><td><p>retention_policies</p></td>
<td><p>no</p></td>
<td><p><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dry_run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clean-snapshots</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">keep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64</span>
<span class="w">    </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snapshots</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clean-snapshots</span>
<span class="w">    </span><span class="nt">recursive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">restrict</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">keep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">    </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">releases</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keep-releases</span>
<span class="w">    </span><span class="nt">recursive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">restrict</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dry_run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clean-snapshots-and-releases</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">keep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64</span>
<span class="w">    </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">snapshots</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clean-snapshots</span>
<span class="w">    </span><span class="nt">recursive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">restrict</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">keep</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="w">    </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">releases</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clean-releases</span>
<span class="w">    </span><span class="nt">recursive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">restrict</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
</pre></div>
</div>
</p></td>
<td><p>List[VersionRetentionPolicies]</p></td>
<td><p>predefined retention policies (see default value). may be referenced via
<code class="code docutils literal notranslate"><span class="pre">retention_policy</span></code> attribute (adding additional policies here has no immediate effect)</p></td>
</tr>
<tr class="row-odd"><td><p>validation_policies</p></td>
<td><p>no</p></td>
<td><p><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ignore-me</span>
</pre></div>
</div>
</p></td>
<td><p>List[str]</p></td>
<td><p>obsolete</p></td>
</tr>
<tr class="row-even"><td><p>ctx_repository_base_url</p></td>
<td><p>no</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p>the component descriptor context repository base_url (for component descriptor v2).
If not configured, the CICD-landscape’s default ctx will be used.</p></td>
</tr>
<tr class="row-odd"><td><p>ctx_repository</p></td>
<td><p>no</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p>the component descriptor context repository cfg name (for component descriptor v2).
If not configured, the CICD-landscape’s default ctx will be used.</p></td>
</tr>
<tr class="row-even"><td><p>ocm_repository</p></td>
<td><p>no</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p>the Component Descriptor OCM Repository url used for publishing.
instead of repository-url, may also be the name of a cfg-element.</p></td>
</tr>
<tr class="row-odd"><td><p>component_labels</p></td>
<td><p>no</p></td>
<td><p><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[]</span>
</pre></div>
</div>
</p></td>
<td><p>List[Label]</p></td>
<td><p>a list of labels to add to the component in the base Component Descriptor</p></td>
</tr>
<tr class="row-even"><td><p>inputs</p></td>
<td><p>no</p></td>
<td><p><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[]</span>
</pre></div>
</div>
</p></td>
<td><p>List[StepInput]</p></td>
<td><p>inputs to expose to component-descriptor step</p></td>
</tr>
<tr class="row-odd"><td><p>depends</p></td>
<td><p>no</p></td>
<td><p><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[]</span>
</pre></div>
</div>
</p></td>
<td><p>List[str]</p></td>
<td><p>steps that need to be run prior to running component-descriptor-step</p></td>
</tr>
<tr class="row-even"><td><p>ocm_repository_mappings</p></td>
<td><p>no</p></td>
<td><p><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[]</span>
</pre></div>
</div>
</p></td>
<td><p>List[OcmRepositoryMappingEntry]</p></td>
<td><p><p>used to explicitly configure where to lookup component descriptors. If given,
ocm_repository <em>must</em> be defined.</p>
<p><strong>Example:</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ocm_repo_url</span>
<span class="w">  </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.com/some-org/</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ocm_repo_url</span>
<span class="w">  </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.com/another-org/</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">another_ocm_repo_url</span>
<span class="w">  </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.com/yet-another-org/</span>
</pre></div>
</div>
<p>Value from ocm_repository is implicitly added as entry.</p>
</p></td>
</tr>
</tbody>
</table>
<h2>upload Enumeration Values<a class="headerlink" href="#trait-component-descriptor" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">legacy</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">no-upload</span></code></p></li>
</ul>
<h2>retention_policies[] <em>(VersionRetentionPolicies)</em> Attributes<a class="headerlink" href="#trait-component-descriptor" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>required?</p></th>
<th class="head"><p>default</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>yes</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>rules</p></td>
<td><p>yes</p></td>
<td><p>None</p></td>
<td><p>List[VersionRetentionPolicy]</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>dry_run</p></td>
<td><p>no</p></td>
<td><p>True</p></td>
<td><p>bool</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<h2>retention_policies[].rules <em>(VersionRetentionPolicy)</em> Attributes<a class="headerlink" href="#trait-component-descriptor" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>required?</p></th>
<th class="head"><p>default</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>no</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>keep</p></td>
<td><p>no</p></td>
<td><p>all</p></td>
<td><p><p>One of:</p>
<ul class="simple">
<li><p>str</p></li>
<li><p>int</p></li>
</ul>
</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>match</p></td>
<td><p>no</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">any</span></code></p></td>
<td><p>VersionType</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>restrict</p></td>
<td><p>no</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td><p>VersionRestriction</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>recursive</p></td>
<td><p>no</p></td>
<td><p>False</p></td>
<td><p>bool</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<h2>component_labels[] <em>(Label)</em> Attributes<a class="headerlink" href="#trait-component-descriptor" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>required?</p></th>
<th class="head"><p>default</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>yes</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>value</p></td>
<td><p>yes</p></td>
<td><p>None</p></td>
<td><p>str | int | float | bool | dict | list</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<h2>inputs[] <em>(StepInput)</em> Attributes<a class="headerlink" href="#trait-component-descriptor" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>required?</p></th>
<th class="head"><p>default</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>step_name</p></td>
<td><p>yes</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>output_name</p></td>
<td><p>no</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>type</p></td>
<td><p>no</p></td>
<td><p>step</p></td>
<td><p>str</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<h2>ocm_repository_mappings[] <em>(OcmRepositoryMappingEntry)</em> Attributes<a class="headerlink" href="#trait-component-descriptor" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>required?</p></th>
<th class="head"><p>default</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>repository</p></td>
<td><p>yes</p></td>
<td><p>None</p></td>
<td><p>str</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>prefix</p></td>
<td><p>no</p></td>
<td><p>None</p></td>
<td><p>str | None</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<h2>Dependencies<a class="headerlink" href="#trait-component-descriptor" title="Link to this heading"></a></h2>
<p>This trait requires the following traits to be declared:</p>
<ul class="simple">
<li><p><a class="reference internal" href="version.html#trait-version"><span class="std std-ref">version trait</span></a></p></li>
</ul>
</section>
<p>If declared, a <code class="code docutils literal notranslate"><span class="pre">Component</span> <span class="pre">Descriptor</span></code> is created during job execution. If their
<a class="reference internal" href="release.html"><span class="doc">release Trait</span></a> trait is also declared, the created component descriptor is added to the
component’s release artifacts (as GitHub release asset).</p>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">traits</span><span class="p">:</span>
<span class="w">  </span><span class="nt">component_descriptor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~</span>
</pre></div>
</div>
</section>
<section id="default-component-descriptor">
<h2>Default Component Descriptor<a class="headerlink" href="#default-component-descriptor" title="Link to this heading"></a></h2>
<p>If no additional customisation is done, a _default_ component descriptor is created with the
following data:</p>
<ul class="simple">
<li><p>component_name (the github repository path, e.g. <code class="code docutils literal notranslate"><span class="pre">github.com/gardener/gardener</span></code>)</p></li>
<li><p>component_version (the <code class="code docutils literal notranslate"><span class="pre">effective</span> <span class="pre">version</span></code>)</p></li>
</ul>
<p>In addition, any container image that is built by the component is added as container image
dependencies.</p>
</section>
<section id="declaring-additional-dependencies">
<h2>Declaring Additional Dependencies<a class="headerlink" href="#declaring-additional-dependencies" title="Link to this heading"></a></h2>
<p>The component descriptor should contain the full “bill-of-materials” that makes up a component.
For many components this will simply be the set of container images built and released by the
component (those are added automatically).</p>
<p>To declare additional dependencies, an executable <em>may</em> be placed at <code class="code docutils literal notranslate"><span class="pre">.ci/component_descriptor</span></code>
at the component repository. If such an executable is present, it is called with a defined set
of environment variables and file system layout.</p>
<p>Before calling the <code class="code docutils literal notranslate"><span class="pre">.ci/component_descriptor</span></code> callback, the default (or base) component descriptor
is generated and offered to the component_descriptor script.</p>
<p>After termination, the component_descriptor script is expected to leave a valid “final”
component_descriptor at a defined file system path. Unresolved <code class="code docutils literal notranslate"><span class="pre">component</span> <span class="pre">references</span></code> are
automatically resolved before uploading as release artifact.</p>
</section>
<section id="environment-variables-passed-to-component-descriptor">
<h2>Environment Variables Passed to component_descriptor<a class="headerlink" href="#environment-variables-passed-to-component-descriptor" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>name</p></th>
<th class="head"><p>explanation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>BASE_DEFINITION_PATH</p></td>
<td><p>absolute file path to base component descriptor</p></td>
</tr>
<tr class="row-odd"><td><p>COMPONENT_DESCRIPTOR_PATH</p></td>
<td><p>absolute file path to output final descriptor to</p></td>
</tr>
<tr class="row-even"><td><p>ADD_DEPENDENCIES_CMD</p></td>
<td><p>CLI cmd args to add dependency to base descriptor (see
<code class="code docutils literal notranslate"><span class="pre">cc-utils/cli.py</span> <span class="pre">productutils</span> <span class="pre">add_dependencies</span> <span class="pre">-h</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p>COMPONENT_NAME</p></td>
<td><p>own component name (e.g. github.com/gardener/vpn)</p></td>
</tr>
<tr class="row-even"><td><p>COMPONENT_VERSION</p></td>
<td><p>the effective version</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id1">
<h2>Example<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<p>How to declare dependencies towards:</p>
<ul class="simple">
<li><p>component <code class="code docutils literal notranslate"><span class="pre">github.com/gardener/vpn</span></code> in version 1.2.3</p></li>
<li><p>component <code class="code docutils literal notranslate"><span class="pre">github.com/gardener/dashboard</span></code> in version 4.5.6</p></li>
<li><p>container image <code class="code docutils literal notranslate"><span class="pre">alpine:3.6</span></code></p></li>
</ul>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># inside .ci/component_descriptor, assuming it is a shell script</span>
<span class="si">${</span><span class="nv">ADD_DEPENDENCIES_CMD</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--component-dependencies<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s1">&#39;{&quot;name&quot;: &quot;github.com/gardener/vpn&quot;, &quot;version&quot;: &quot;1.2.3&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--component-dependencies<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s1">&#39;{&quot;name&quot;: &quot;github.com/gardener/dashboard&quot;, &quot;version&quot;: &quot;4.5.6&quot;}&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--container-image-dependencies<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s1">&#39;{&quot;image_reference&quot;: &quot;alpine:3.6&quot;, &quot;version&quot;: &quot;3.6&quot;, &quot;name&quot;: &quot;alpine&quot;}&#39;</span>
<span class="c1"># don&#39;t forget to expose the image</span>
cp<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASE_DEFINITION_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">COMPONENT_DESCRIPTOR_PATH</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>
<section id="local-development-and-component-cli">
<h2>Local Development and “component-cli”<a class="headerlink" href="#local-development-and-component-cli" title="Link to this heading"></a></h2>
<p>Setting up a local development environment for running the <code class="code docutils literal notranslate"><span class="pre">component_descriptor</span></code> step may be
cumbersome. Therefore, a convenience command is provided from <code class="code docutils literal notranslate"><span class="pre">gardener-cicd-cli</span></code> python package
that evaluates both <code class="code docutils literal notranslate"><span class="pre">.ci/pipeline_definitions</span></code> (+ optional <code class="code docutils literal notranslate"><span class="pre">branch.cfg</span></code>), and calls a
<code class="code docutils literal notranslate"><span class="pre">.ci/component_descriptor</span></code> callback script, thus creating a similar output as if running in
cicd-pipeline.</p>
<section id="setting-up-preliminaries">
<h3>Setting up Preliminaries<a class="headerlink" href="#setting-up-preliminaries" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>install python3 as indicated by <code class="code docutils literal notranslate"><span class="pre">gardener-cicd-cli</span></code>-package (3.10+)</p></li>
<li><p>run <code class="code docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">gardener-cicd-cli</span></code> (python-headers + c-compiler-toolchain might be required)</p></li>
<li><p>optional: install <code class="code docutils literal notranslate"><span class="pre">component-cli</span></code> to PATH</p></li>
<li><p>install other runtime-dependencies as needed by local <code class="code docutils literal notranslate"><span class="pre">.ci/component_descriptor</span></code> callback script</p></li>
</ul>
<p>If repository in question uses <code class="code docutils literal notranslate"><span class="pre">branch.cfg</span></code> (in special ref <code class="code docutils literal notranslate"><span class="pre">refs/meta/ci</span></code>), fetch it into local
repository by running: <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span> <span class="pre">origin</span> <span class="pre">refs/meta/ci:refs/meta/ci</span></code> (use different origin as needed).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>pass <code class="code docutils literal notranslate"><span class="pre">--meta-ci</span> <span class="pre">fetch</span></code> to tell the command (see below) to fetch refs/meta/ci for you</p>
</div>
</section>
<section id="rendering-component-descriptor">
<h3>Rendering Component-Descriptor<a class="headerlink" href="#rendering-component-descriptor" title="Link to this heading"></a></h3>
<p>Run the following command (available from PATH after installing <code class="code docutils literal notranslate"><span class="pre">gardener-cicd-cli</span></code>) (chdir into
repository’s working tree):</p>
<p><code class="code docutils literal notranslate"><span class="pre">gardener-ci</span> <span class="pre">pipeline</span> <span class="pre">component_descriptor</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">pipeline</span> <span class="pre">component_descriptor</span></code> command tries to guess things like component-name, or the
pipeline to use (preferring a pipeline-job that is likely the release-job).
Pass the <code class="code docutils literal notranslate"><span class="pre">-h</span></code> (or <code class="code docutils literal notranslate"><span class="pre">--help</span></code>) flag to display online-help. Most heuristics can be overwritten.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Component-Descriptors creating this way will be close to those that will be created by
CICD Pipeline Jobs, but not necessarily 100% accurate (for example, image-tag-templates are
not evaluated, which may lead to different image-tags in “base-component-descriptors”).</p>
</div>
</section>
</section>
<section id="special-handling-for-charts-images-yaml-deprecating-component-cli">
<h2>Special-handling for “charts/images.yaml” / deprecating component-cli<a class="headerlink" href="#special-handling-for-charts-images-yaml-deprecating-component-cli" title="Link to this heading"></a></h2>
<p><code class="code docutils literal notranslate"><span class="pre">component-cli</span></code> has been deprecated as of 2023-04-06. <code class="code docutils literal notranslate"><span class="pre">component-cli</span></code> was tailored as an
opinionated tool considering some special-cases useful for many of Gardener’s repositories in
mind. It’s successor - <a class="reference external" href="https://github.com/open-component-model/ocm#ocm-cli">OCM-CLI</a> might
replace <code class="code docutils literal notranslate"><span class="pre">component-cli</span></code>, however it will not feature said gardener-specific special-case-handling.</p>
<p>To phase-out <code class="code docutils literal notranslate"><span class="pre">component-cli</span></code>, with little efforts all relevant commands are
re-implemented as part of CICD-Pipeline-Template as a drop-in-replacement.
Implementation can be found
<a class="reference external" href="https://github.com/gardener/cc-utils/blob/master/bin/component-cli">here</a>.</p>
<p>The default instrumentation of component-cli commands can be found
<a class="reference external" href="https://github.com/gardener/gardener/blob/master/hack/.ci/component_descriptor">here</a>.</p>
<section id="imagevector-add-command-charts-images-yaml-contract">
<h3>“imagevector add” command / charts/images.yaml contract<a class="headerlink" href="#imagevector-add-command-charts-images-yaml-contract" title="Link to this heading"></a></h3>
<p>Some Gardener-Repositories use a standardised format to declare images to be exposed to both
helm-charts and <code class="code docutils literal notranslate"><span class="pre">Component-Descriptors</span></code> via a regular file located at <code class="code docutils literal notranslate"><span class="pre">charts/images.yaml</span></code> below
repository root.</p>
<p>The (deprecated) <code class="code docutils literal notranslate"><span class="pre">component-cli</span></code> features a command <code class="code docutils literal notranslate"><span class="pre">imagevector</span> <span class="pre">add</span></code> that converts data from such
<code class="code docutils literal notranslate"><span class="pre">images.yaml</span></code> files to component-descriptors.</p>
<p><code class="code docutils literal notranslate"><span class="pre">images.yaml</span></code> is expected to be a YAML document (or multi-document) containing (oci-)image-entries.
Those are stored as a list below an attribute <code class="code docutils literal notranslate"><span class="pre">images</span></code>. Depending on the defined attributes,
entries are handled differently.</p>
<p>In addition to attributes being absent, or present, there is also a list of “component-prefixes”,
which defaults to <code class="code docutils literal notranslate"><span class="pre">eu.gcr.io/gardener-project/gardener</span></code>, which influences whether an entry is
considered to be “local” (built by component’s pipeline) or “external” (built by someone else).</p>
<p>Gardener-Components have a name that is by convention the github-repo-url (w/o scheme). If the
<code class="code docutils literal notranslate"><span class="pre">sourceRepository</span></code> is different from current component name, a component-reference is added.</p>
<p><em>Example</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># current component: github.com/gardener/gardener</span>
<span class="c1"># current version: 1.67.0</span>
<span class="c1"># github-repo: github.com/gardener/gardener</span>

<span class="nt">images</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gardenlet</span>
<span class="w">  </span><span class="nt">sourceRepository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.com/gardener/gardener</span><span class="w"> </span><span class="c1"># same as current component in this example</span>
<span class="w">  </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eu.gcr.io/gardener-project/gardener/gardenlet</span>
</pre></div>
</div>
<p><em>Results in:</em></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">resources</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gardenlet</span><span class="w"> </span><span class="c1"># from name-attribute</span>
<span class="w">  </span><span class="nt">relation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span><span class="w"> </span><span class="c1"># from repository&#39;s prefix matching eu.gcr.io/gardener-project/gardener</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ociImage</span><span class="w"> </span><span class="c1"># hard-coded</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.67.0</span><span class="w"> </span><span class="c1"># from current version</span>
<span class="w">  </span><span class="nt">access</span><span class="p">:</span>
<span class="w">   </span><span class="nt">imageReference</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eu.gcr.io/gardener-project/gardener/gardenlet:1.67.0</span><span class="w"> </span><span class="c1"># &lt;repo&gt;:&lt;version&gt;</span>
<span class="w">   </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ociRegistry</span><span class="w"> </span><span class="c1"># hard-coded</span>
<span class="w w-Error"> </span><span class="nt">labels</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">imagevector.gardener.cloud/name</span>
<span class="w">   </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gardenlet</span><span class="w"> </span><span class="c1"># from name-attribute</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">imagevector.gardener.cloud/repository</span>
<span class="w">   </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eu.gcr.io/gardener-project/gardener/gardenlet</span><span class="w"> </span><span class="c1"># from repository-attribute</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">imagevector.gardener.cloud/source-repository</span>
<span class="w">   </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">github.com/gardener/gardener</span><span class="w"> </span><span class="c1"># github-repo</span>
</pre></div>
</div>
</section>
</section>
<section id="retention-policies-aka-cleaning-up-old-versions">
<h2>Retention Policies (aka cleaning up old versions)<a class="headerlink" href="#retention-policies-aka-cleaning-up-old-versions" title="Link to this heading"></a></h2>
<p>The <code class="code docutils literal notranslate"><span class="pre">retention_policies</span></code> attribute can be used to configure automated removal of
component descriptors and referenced <code class="code docutils literal notranslate"><span class="pre">resources</span></code> (mostly OCI Container Images).</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Removal of component descriptors and referenced resources is _permanent_. There is no
backup mechanism in place. Use with care. For example, if multiple component descriptors
share reference to the same OCI Artefact (using the same registry, repository, and tag)
removal of any of the referencing component descriptors will lead to stale references
in other component descriptors.</p>
</div>
<section id="cleanup-semantics-and-use-case">
<h3>Cleanup Semantics and Use-Case<a class="headerlink" href="#cleanup-semantics-and-use-case" title="Link to this heading"></a></h3>
<p>If frequently publishing component-descriptors as snapshot-versions (e.g. for each head-update,
or for pull-request-validation), thus-produced build artefacts and component descriptors
typically are only relevant for a short period of time. In such cases, automated cleanup
of snapshot-versions can be configured (see attribute-documentation above).</p>
<p>It is possible to further narrow-down versions to cleanup, by setting the <code class="code docutils literal notranslate"><span class="pre">restrict</span></code>-attribute
to <code class="code docutils literal notranslate"><span class="pre">same-minor</span></code>. If thus-configured, cleanup will only be done among component descriptors that
share the same minor version w/ the current component version.</p>
<p>Policy rules are evaluated in the order they are defined. When cleanup is run, all existing
versions (in current component descriptor repository) are retrieved, and grouped by defined
cleanup rules (each version is added exactly to the first matching rule; if no rule matches,
versions are dropped (thus exempted from cleanup)).</p>
<p>Each thus-collected group of versions is ordered, acccording to “relaxed” semver-arithmetics,
from smallest to greatest. Depending on the amount of versions to “keep” (<code class="code docutils literal notranslate"><span class="pre">keep</span></code> attribute),
starting from smallest, progressing to greatest, versions to be removed are determined. It is
possible that no version is identified as being subject for cleanup.</p>
<p>For each version to be removed the component-descriptor to be removed is fetched and processed:</p>
<p>Sources are ignored.</p>
<p>From declared resources, all resources that are supported for removal are removed.</p>
<p>A resource is considered to be supported for removal if it has been declared of <code class="code docutils literal notranslate"><span class="pre">relation:</span> <span class="pre">local</span></code>
(i.e. it was built along w/ the component-descriptor), and if its access-type is supported
by underlying CICD Infrastructure. This is currently limited to OCI Artefacts (including
“multi-arch” Images), and subject to being extended over time. Blobs that are inlined within
component descriptor OCI Artefact will be implicitly along with the component descriptor.</p>
<p>Once all supported resources have been removed, the declaring component descriptor is removed.</p>
<p>For performance reasons, cleanup may be limited to an internally defined amount of versions.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../traits.html" class="btn btn-neutral float-left" title="Pipeline Definition Traits" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cronjob.html" class="btn btn-neutral float-right" title="cronjob Trait" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019-2020, SAP SE or an SAP affiliate company..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>